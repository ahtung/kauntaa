test:
  override:
    - mkdir -p $CIRCLE_TEST_REPORTS/cucumber
    - mkdir -p $CIRCLE_TEST_REPORTS/rspec
    - bundle exec rake spec
    - bundle exec rake style
    - bundle exec rake security
    - bundle exec rake quality
    - bundle exec rake cucumber --format json --out $CIRCLE_TEST_REPORTS/cucumber/tests.cucumber
        environment:
          RACK_ENV: test
deployment:
  staging:
    branch: develop
    commands:
      - ./script/deploy/staging
      - bundle exec rake cucumber --format json --out $CIRCLE_TEST_REPORTS/cucumber/tests.cucumber
          environment:
            RACK_ENV: staging
  production:
    branch: master
    commands:
      - ./script/deploy/production
      - bundle exec rake cucumber --format json --out $CIRCLE_TEST_REPORTS/cucumber/tests.cucumber
          environment:
            RACK_ENV: production
